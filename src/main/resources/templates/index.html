<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Malzeme-Teknik-Form Matrisi</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .matrix-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .category-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .category {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            transition: all 0.3s ease;
        }
        .category[data-order="1"] { 
            order: 1;
            margin-top: 0;
        }
        .category[data-order="2"] { 
            order: 2;
            margin-top: 20px;
        }
        .category[data-order="3"] { 
            order: 3;
            margin-top: 20px;
        }
        .category-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
        }
        .category-header h2 {
            margin: 0;
            color: #333;
            font-size: 1.5em;
        }
        .info-button {
            background: none;
            border: none;
            color: #4a90e2;
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        .info-button:hover {
            transform: scale(1.1);
            background-color: #f5f9ff;
        }
        .selection-box {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 6px;
            margin: 4px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            background-color: white;
            width: 105px;
            height: 135px;
            position: relative;
            z-index: 1;
        }
        .selection-box:hover {
            border-color: #4a90e2;
            transform: translateY(-2px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        .selection-box.active {
            border-color: #4a90e2;
            background-color: #f5f9ff;
        }
        .selection-box.inactive {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .selection-box.selected {
            border-color: #2ecc71;
            background-color: #f0fff4;
        }
        .material-icon, .technique-icon, .form-icon {
            width: 85px;
            height: 85px;
            object-fit: contain;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
            padding: 3px;
            background-color: white;
            transition: all 0.3s ease;
            margin-bottom: 4px;
        }
        .selection-box:hover .material-icon,
        .selection-box:hover .technique-icon,
        .selection-box:hover .form-icon {
            border-color: #4a90e2;
            transform: translateY(-2px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        .selection-box.active .material-icon,
        .selection-box.active .technique-icon,
        .selection-box.active .form-icon {
            border-color: #4a90e2;
            background-color: #f5f9ff;
        }
        .material-name, .technique-name, .form-name {
            text-align: center;
            font-size: 0.8em;
            color: #333;
            margin-top: 2px;
            width: 100%;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            line-height: 1.1;
            height: 2.2em;
            padding: 0 1px;
            word-wrap: break-word;
            hyphens: auto;
        }
        .selection-boxes {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            justify-content: center;
            padding: 4px;
        }
        .file-upload {
            margin-top: 30px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
            text-align: center;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
            border: 1px solid #e0e0e0;
        }
        .file-upload input[type="file"] {
            display: none;
        }
        .file-upload label {
            display: inline-block;
            padding: 8px 16px;
            background-color: #4a90e2;
            color: white;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
            font-size: 0.9em;
        }
        .file-upload label:hover {
            background-color: #357abd;
        }
        .file-name {
            margin-top: 8px;
            color: #666;
            font-size: 0.9em;
        }
        .start-selection {
            text-align: center;
            margin-bottom: 30px;
        }
        .start-selection .btn {
            background-color: #4a90e2;
            border-color: #4a90e2;
            color: white;
            margin: 0 10px;
            padding: 10px 30px;
            font-size: 1.2em;
        }
        .start-selection .btn:hover {
            background-color: #357abd;
            border-color: #357abd;
        }
        .reset-button {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }
        .popup-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1;
            justify-content: center;
            align-items: center;
        }
        .popup-content {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            max-width: 500px;
            width: 90%;
            position: relative;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 2;
        }
        .popup-close {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            font-size: 1.2em;
            cursor: pointer;
            color: #666;
        }
        .popup-close:hover {
            color: #333;
        }
        .item-info-button {
            position: absolute;
            top: 5px;
            right: 5px;
            background: none;
            border: none;
            color: #4a90e2;
            cursor: pointer;
            padding: 2px;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            opacity: 0;
            font-size: 0.8em;
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 50%;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            z-index: 2;
        }
        .selection-box:hover .item-info-button {
            opacity: 1;
            transform: scale(1.1);
        }
        .item-info-button:hover {
            background-color: #f5f9ff;
            transform: scale(1.2);
        }
        .tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background-color: white;
            padding: 10px;
            border-radius: 6px;
            box-shadow: 0 2px 16px 2px rgba(0,0,0,0.25);
            width: 220px;
            z-index: 9999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            margin-bottom: 5px;
            pointer-events: none;
            display: none;
        }
        .tooltip.show {
            opacity: 1;
            visibility: visible;
            pointer-events: auto;
            display: block;
        }
        .tooltip:after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: white transparent transparent transparent;
        }
        .tooltip h4 {
            margin: 0 0 5px 0;
            color: #333;
            font-size: 0.9em;
        }
        .tooltip p {
            margin: 0;
            color: #666;
            font-size: 0.8em;
            line-height: 1.4;
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h1 class="text-center mb-4">Malzeme-Teknik-Form Matrisi</h1>
        
        <div class="start-selection">
            <h3 class="mb-4">Başlangıç seçimini yapın:</h3>
            <button class="btn" onclick="startWith('material')">Malzeme ile Başla</button>
            <button class="btn" onclick="startWith('technique')">Teknik ile Başla</button>
            <button class="btn" onclick="startWith('form')">Form ile Başla</button>
        </div>

        <div class="file-upload">
            <form id="uploadForm" th:action="@{/upload}" method="post" enctype="multipart/form-data">
                <input type="file" name="file" id="file" accept=".xlsx,.xls" onchange="updateFileName(this)">
                <label for="file">Excel Dosyası Seç</label>
                <div class="file-name" id="fileName"></div>
            </form>
        </div>

        <div class="matrix-container" style="display: none;">
            <button class="btn btn-secondary reset-button" onclick="resetToStart()">
                <i class="fas fa-home"></i> Ana Sayfaya Dön
            </button>
            <div class="row justify-content-center">
                <div class="col-md-8">
                    <div class="category-container">
                        <div id="materialsCategory" class="category" data-type="material">
                            <div class="category-header">
                                <h2>Malzemeler</h2>
                                <button class="info-button" onclick="showInfo('material')">
                                    ℹ️
                                </button>
                            </div>
                            <div class="selection-boxes">
                                <div th:each="material : ${materials}" class="selection-box active" 
                                     th:data-material="${material.name}"
                                     th:data-material-number="${material.id}"
                                     th:title="${material.name}"
                                     onclick="selectMaterial(this)">
                                    <button class="item-info-button" 
                                            th:data-type="'material'"
                                            th:data-name="${material.name}"
                                            th:data-number="${material.id}"
                                            th:data-description="${material.description}">
                                        ℹ️
                                    </button>
                                    <div class="tooltip">
                                        <h4 th:text="${material.name}"></h4>
                                        <p>Malzeme Kodu: <span th:text="${material.id}"></span></p>
                                        <p th:text="${material.description}"></p>
                                        <p th:if="${!material.features.empty}">
                                            <strong>Özellikler:</strong><br/>
                                            <span th:each="feature : ${material.features}" th:text="${feature + ', '}"></span>
                                        </p>
                                    </div>
                                    <img th:if="${material.id}" 
                                         th:src="@{'/icons/Malzeme icon/' + ${material.id} + '.jpg'}"
                                         class="material-icon" 
                                         th:onerror="this.src=@{'/icons/Malzeme icon/' + ${material.id} + '.JPG'}; this.onerror=function(){this.src=@{'/icons/Malzeme icon/' + ${material.id} + '.png'}; this.onerror=function(){this.src=@{'/icons/Malzeme icon/' + ${material.id} + '.PNG'}; this.onerror=function(){this.style.display='none'}}}"
                                         onerror="this.onerror=null; this.style.display='none'">
                                    <span class="material-name" th:text="${material.name}"></span>
                                </div>
                            </div>
                        </div>
                        
                        <div id="techniquesCategory" class="category" data-type="technique">
                            <div class="category-header">
                                <h2>Teknikler</h2>
                                <button class="info-button" onclick="showInfo('technique')">
                                    ℹ️
                                </button>
                            </div>
                            <div class="selection-boxes">
                                <div th:each="technique : ${techniques}" class="selection-box inactive" 
                                     th:data-technique="${technique.name}"
                                     th:data-technique-number="${technique.id}"
                                     th:title="${technique.name}"
                                     onclick="selectTechnique(this)">
                                    <button class="item-info-button" 
                                            th:data-type="'technique'"
                                            th:data-name="${technique.name}"
                                            th:data-number="${technique.id}"
                                            th:data-description="${technique.description}">
                                        ℹ️
                                    </button>
                                    <div class="tooltip">
                                        <h4 th:text="${technique.name}"></h4>
                                        <p>Teknik Kodu: <span th:text="${technique.id}"></span></p>
                                        <p th:text="${technique.description}"></p>
                                        <p th:if="${!technique.features.empty}">
                                            <strong>Özellikler:</strong><br/>
                                            <span th:each="feature : ${technique.features}" th:text="${feature + ', '}"></span>
                                        </p>
                                    </div>
                                    <img th:if="${technique.id}" 
                                         th:src="@{'/icons/Teknikler icon/' + ${technique.id} + '.jpg'}"
                                         class="technique-icon" 
                                         th:onerror="this.src=@{'/icons/Teknikler icon/' + ${technique.id} + '.JPG'}; this.onerror=function(){this.src=@{'/icons/Teknikler icon/' + ${technique.id} + '.png'}; this.onerror=function(){this.src=@{'/icons/Teknikler icon/' + ${technique.id} + '.PNG'}; this.onerror=function(){this.style.display='none'}}}"
                                         onerror="this.onerror=null; this.style.display='none'">
                                    <span class="technique-name" th:text="${technique.name}"></span>
                                </div>
                            </div>
                        </div>
                        
                        <div id="formsCategory" class="category" data-type="form">
                            <div class="category-header">
                                <h2>Formlar</h2>
                                <button class="info-button" onclick="showInfo('form')">
                                    ℹ️
                                </button>
                            </div>
                            <div class="selection-boxes">
                                <div th:each="form : ${forms}" class="selection-box inactive" 
                                     th:data-form="${form.name}"
                                     th:data-form-number="${form.id}"
                                     th:title="${form.name}"
                                     onclick="selectForm(this)">
                                    <button class="item-info-button" 
                                            th:data-type="'form'"
                                            th:data-name="${form.name}"
                                            th:data-number="${form.id}"
                                            th:data-description="${form.description}">
                                        ℹ️
                                    </button>
                                    <div class="tooltip">
                                        <h4 th:text="${form.name}"></h4>
                                        <p>Form Kodu: <span th:text="${form.id}"></span></p>
                                        <p th:text="${form.description}"></p>
                                        <p th:if="${!form.features.empty}">
                                            <strong>Özellikler:</strong><br/>
                                            <span th:each="feature : ${form.features}" th:text="${feature + ', '}"></span>
                                        </p>
                                    </div>
                                    <img th:if="${form.id}" 
                                         th:src="@{'/icons/Form icon/' + ${form.id} + '/' + ${form.id} + '.jpg'}"
                                         class="form-icon" 
                                         th:onerror="this.src=@{'/icons/Form icon/' + ${form.id} + '/' + ${form.id} + ' wire.png'}"
                                         onerror="this.onerror=null; this.style.display='none'">
                                    <span class="form-name" th:text="${form.name}"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="popup-overlay" id="popupOverlay" onclick="closePopup(event)">
        <div class="popup-content" onclick="event.stopPropagation()">
            <button class="popup-close" onclick="closePopup()">&times;</button>
            <div id="popupInfo"></div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/js/all.min.js"></script>
    <script th:inline="javascript">
        const relationships = /*[[${matrixData.relationships}]]*/ [];
        let selectedMaterial = null;
        let selectedTechnique = null;
        let selectedForm = null;
        let startType = null;

        function startWith(type) {
            startType = type;
            document.querySelector('.start-selection').style.display = 'none';
            document.querySelector('.matrix-container').style.display = 'block';
            document.querySelector('.file-upload').style.display = 'none';
            
            // Reset all selections
            resetAllSelections();
            
            // Reorder categories based on start type
            const categories = document.querySelectorAll('.category');
            categories.forEach(category => {
                const categoryType = category.getAttribute('data-type');
                let order;
                
                switch(type) {
                    case 'material':
                        // Malzeme -> Teknik -> Form
                        if (categoryType === 'material') order = 1;
                        else if (categoryType === 'technique') order = 2;
                        else if (categoryType === 'form') order = 3;
                        break;
                    case 'technique':
                        // Teknik -> Form -> Malzeme
                        if (categoryType === 'technique') order = 1;
                        else if (categoryType === 'form') order = 2;
                        else if (categoryType === 'material') order = 3;
                        break;
                    case 'form':
                        // Form -> Teknik -> Malzeme
                        if (categoryType === 'form') order = 1;
                        else if (categoryType === 'technique') order = 2;
                        else if (categoryType === 'material') order = 3;
                        break;
                }
                
                category.setAttribute('data-order', order);
            });
            
            // Activate all options in the starting category
            const startCategory = document.querySelector(`.category[data-type="${type}"]`);
            if (startCategory) {
                const options = startCategory.querySelectorAll('.selection-box');
                options.forEach(option => {
                    option.classList.remove('inactive');
                    option.classList.add('active');
                });
            }
            
            // Scroll to the top of the container
            document.querySelector('.matrix-container').scrollTop = 0;
        }

        function resetAllSelections() {
            // Reset all selections
            selectedMaterial = null;
            selectedTechnique = null;
            selectedForm = null;
            
            // Reset all option states
            const allOptions = document.querySelectorAll('.selection-box');
            allOptions.forEach(option => {
                option.classList.remove('selected', 'inactive');
                option.classList.add('active');
            });
        }

        function updateFileName(input) {
            const fileName = input.files[0]?.name || 'Dosya seçilmedi';
            document.getElementById('fileName').textContent = fileName;
            if (input.files[0]) {
                input.form.submit();
            }
        }

        function selectMaterial(element) {
            const material = element.getAttribute('data-material');
            
            if (selectedMaterial === material) {
                // Deselect if already selected
                selectedMaterial = null;
                element.classList.remove('selected');
                
                // Reset all options to active state
                const allOptions = document.querySelectorAll('.selection-box');
                allOptions.forEach(opt => {
                    opt.classList.remove('inactive');
                    opt.classList.add('active');
                });
            } else {
                // Select new material
                selectedMaterial = material;
                document.querySelectorAll('.selection-box[data-material]').forEach(opt => opt.classList.remove('selected'));
                element.classList.add('selected');
                
                // Update technique and form states based on relationships
                updateTechniqueStates();
                updateFormStates();
            }
        }

        function selectTechnique(element) {
            const technique = element.getAttribute('data-technique');
            
            if (selectedTechnique === technique) {
                // Deselect if already selected
                selectedTechnique = null;
                element.classList.remove('selected');
                
                // Reset all options to active state
                const allOptions = document.querySelectorAll('.selection-box');
                allOptions.forEach(opt => {
                    opt.classList.remove('inactive');
                    opt.classList.add('active');
                });
            } else {
                // Select new technique
                selectedTechnique = technique;
                document.querySelectorAll('.selection-box[data-technique]').forEach(opt => opt.classList.remove('selected'));
                element.classList.add('selected');
                
                // Update material and form states based on relationships
                updateMaterialStates();
                updateFormStates();
            }
        }

        function selectForm(element) {
            const form = element.getAttribute('data-form');
            
            if (selectedForm === form) {
                // Deselect if already selected
                selectedForm = null;
                element.classList.remove('selected');
                
                // Reset all options to active state
                const allOptions = document.querySelectorAll('.selection-box');
                allOptions.forEach(opt => {
                    opt.classList.remove('inactive');
                    opt.classList.add('active');
                });
            } else {
                // Select new form
                selectedForm = form;
                document.querySelectorAll('.selection-box[data-form]').forEach(opt => opt.classList.remove('selected'));
                element.classList.add('selected');
                
                // Update material and technique states based on relationships
                updateMaterialStates();
                updateTechniqueStates();
            }
        }

        function updateMaterialStates() {
            const materialBoxes = document.querySelectorAll('.selection-box[data-material]');
            materialBoxes.forEach(box => {
                const material = box.getAttribute('data-material');
                if (startType === 'material') {
                    // If starting with material, all materials are active
                    box.classList.remove('inactive');
                    box.classList.add('active');
                } else {
                    // Check relationships with current selections
                    const isRelated = hasAnyRelationship(material, selectedTechnique, selectedForm);
                    if (isRelated) {
                        box.classList.remove('inactive');
                        box.classList.add('active');
                    } else {
                        box.classList.remove('active');
                        box.classList.add('inactive');
                    }
                }
            });
        }

        function updateTechniqueStates() {
            const techniqueBoxes = document.querySelectorAll('.selection-box[data-technique]');
            techniqueBoxes.forEach(box => {
                const technique = box.getAttribute('data-technique');
                if (startType === 'technique') {
                    // If starting with technique, all techniques are active
                    box.classList.remove('inactive');
                    box.classList.add('active');
                } else {
                    // Check relationships with current selections
                    const isRelated = hasAnyRelationship(selectedMaterial, technique, selectedForm);
                    if (isRelated) {
                        box.classList.remove('inactive');
                        box.classList.add('active');
                    } else {
                        box.classList.remove('active');
                        box.classList.add('inactive');
                    }
                }
            });
        }

        function updateFormStates() {
            const formBoxes = document.querySelectorAll('.selection-box[data-form]');
            formBoxes.forEach(box => {
                const form = box.getAttribute('data-form');
                if (startType === 'form') {
                    // If starting with form, all forms are active
                    box.classList.remove('inactive');
                    box.classList.add('active');
                } else {
                    // Check relationships with current selections
                    const isRelated = hasAnyRelationship(selectedMaterial, selectedTechnique, form);
                    if (isRelated) {
                        box.classList.remove('inactive');
                        box.classList.add('active');
                    } else {
                        box.classList.remove('active');
                        box.classList.add('inactive');
                    }
                }
            });
        }

        function getNextCategory(type) {
            switch(type) {
                case 'material': return 'technique';
                case 'technique': return 'material';
                case 'form': return 'technique';
                default: return null;
            }
        }

        function hasAnyRelationship(material, technique, form) {
            return relationships.some(rel => 
                (!material || rel.material === material) && 
                (!technique || rel.technique === technique) && 
                (!form || rel.form === form)
            );
        }

        function resetToStart() {
            startType = null;
            document.querySelector('.start-selection').style.display = 'block';
            document.querySelector('.matrix-container').style.display = 'none';
            document.querySelector('.file-upload').style.display = 'block';
            
            // Reset category orders
            const categories = document.querySelectorAll('.category');
            categories.forEach(category => {
                category.removeAttribute('data-order');
            });
            
            resetAllSelections();
            
            // Scroll to top of the page
            window.scrollTo(0, 0);
        }

        function showInfo(type) {
            const popupOverlay = document.getElementById('popupOverlay');
            const popupInfo = document.getElementById('popupInfo');
            let content = '';
            
            switch(type) {
                case 'material':
                    content = `
                        <h3>Malzemeler Hakkında</h3>
                        <p>Malzemeler, üretimde kullanılan temel hammaddeleri temsil eder. Her malzeme, belirli teknikler ve formlarla uyumlu çalışabilir.</p>
                        <ul>
                            <li>Malzeme seçimi, üretim sürecinin ilk adımıdır</li>
                            <li>Her malzemenin kendine özgü özellikleri vardır</li>
                            <li>Malzeme seçimi, teknik ve form seçimini etkiler</li>
                        </ul>
                    `;
                    break;
                case 'technique':
                    content = `
                        <h3>Teknikler Hakkında</h3>
                        <p>Teknikler, malzemelerin işlenme yöntemlerini gösterir. Her teknik, belirli malzemeler ve formlarla uyumlu çalışabilir.</p>
                        <ul>
                            <li>Teknik seçimi, üretim yöntemini belirler</li>
                            <li>Her tekniğin kendine özgü avantajları vardır</li>
                            <li>Teknik seçimi, malzeme ve form seçimini etkiler</li>
                        </ul>
                    `;
                    break;
                case 'form':
                    content = `
                        <h3>Formlar Hakkında</h3>
                        <p>Formlar, ürünün son şeklini temsil eder. Her form, belirli malzemeler ve tekniklerle uyumlu çalışabilir.</p>
                        <ul>
                            <li>Form seçimi, ürünün görsel ve fonksiyonel özelliklerini belirler</li>
                            <li>Her formun kendine özgü tasarım gereksinimleri vardır</li>
                            <li>Form seçimi, malzeme ve teknik seçimini etkiler</li>
                        </ul>
                    `;
                    break;
            }
            
            popupInfo.innerHTML = content;
            popupOverlay.style.display = 'flex';
        }

        function closePopup(event) {
            if (event) {
                event.stopPropagation();
            }
            document.getElementById('popupOverlay').style.display = 'none';
        }

        // Popup dışına tıklandığında kapatma
        document.addEventListener('click', function(event) {
            const popupOverlay = document.getElementById('popupOverlay');
            if (event.target === popupOverlay) {
                closePopup();
            }
        });

        // Türkçe karakterleri ve özel karakterleri normalize etmek için yardımcı fonksiyon
        function normalizeTurkishChars(str) {
            return str
                .replace(/[\n\r]+/g, ' ') // Satır sonlarını boşluğa çevir
                .replace(/\s+/g, ' ') // Birden fazla boşluğu tek boşluğa çevir
                .replace(/ğ/g, 'g')
                .replace(/Ğ/g, 'G')
                .replace(/ü/g, 'u')
                .replace(/Ü/g, 'U')
                .replace(/ş/g, 's')
                .replace(/Ş/g, 'S')
                .replace(/ı/g, 'i')
                .replace(/İ/g, 'I')
                .replace(/ö/g, 'o')
                .replace(/Ö/g, 'O')
                .replace(/ç/g, 'c')
                .replace(/Ç/g, 'C')
                .trim(); // Baştaki ve sondaki boşlukları temizle
        }

        function showItemInfo(type, name, number, description) {
            const popupOverlay = document.getElementById('popupOverlay');
            const popupInfo = document.getElementById('popupInfo');
            let content = '';
            
            // Get the features from the tooltip
            const normalizedName = normalizeTurkishChars(name);
            const escapedName = normalizedName.replace(/[!"#$%&'()*+,.\/:;<=>?@[\\\]^`{|}~]/g, '\\$&');
            const tooltip = document.querySelector(`.selection-box[data-${type}="${escapedName}"] .tooltip`);
            const features = tooltip ? tooltip.querySelector('p:last-child')?.textContent : '';
            
            switch(type) {
                case 'material':
                    content = `
                        <h3>${name}</h3>
                        <p>Malzeme Kodu: ${number}</p>
                        <div class="info-details">
                            <p>${description}</p>
                            ${features ? `<div class="features">
                                <h4>Özellikler:</h4>
                                <p>${features}</p>
                            </div>` : ''}
                        </div>
                    `;
                    break;
                case 'technique':
                    content = `
                        <h3>${name}</h3>
                        <p>Teknik Kodu: ${number}</p>
                        <div class="info-details">
                            <p>${description}</p>
                            ${features ? `<div class="features">
                                <h4>Özellikler:</h4>
                                <p>${features}</p>
                            </div>` : ''}
                        </div>
                    `;
                    break;
                case 'form':
                    content = `
                        <h3>${name}</h3>
                        <p>Form Kodu: ${number}</p>
                        <div class="info-details">
                            <p>${description}</p>
                            ${features ? `<div class="features">
                                <h4>Özellikler:</h4>
                                <p>${features}</p>
                            </div>` : ''}
                        </div>
                    `;
                    break;
            }
            
            popupInfo.innerHTML = content;
            popupOverlay.style.display = 'flex';
        }

        // Info butonları için event listener
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.item-info-button').forEach(button => {
                button.addEventListener('click', function(event) {
                    event.stopPropagation();
                    const type = this.getAttribute('data-type');
                    const name = this.getAttribute('data-name');
                    const number = this.getAttribute('data-number');
                    const description = this.getAttribute('data-description');
                    
                    showItemInfo(type, name, number, description);
                });
            });

            // Tooltip dışına tıklandığında kapat
            document.addEventListener('click', function(event) {
                if (!event.target.closest('.tooltip') && !event.target.closest('.item-info-button')) {
                    document.querySelectorAll('.tooltip').forEach(tooltip => {
                        tooltip.classList.remove('show');
                    });
                }
            });
        });
    </script>
</body>
</html> 